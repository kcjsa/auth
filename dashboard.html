<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>KS Dashboard</title>
  <style>
    body { font-family: sans-serif; }
    pre {
      background: #111;
      color: #0f0;
      padding: 12px;
      user-select: all;
    }
    button {
      padding: 8px 16px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>Dashboard</h1>

  <p><b>Discord ID</b></p>
  <pre id="discordId"></pre>

  <p><b>User ID</b></p>
  <pre id="userId"></pre>

  <button onclick="generate()">リンクコード生成</button>

  <h2>Link Code（10分有効）</h2>
  <pre id="code">---</pre>

  <h2>Minecraft で実行</h2>
  <pre id="mc">---</pre>

  <script>
    const p = new URLSearchParams(location.search);
    const userId = p.get("userId");
    const discordId = p.get("discordId");

    if (!userId || !discordId) {
      alert("未ログイン");
      location.href = "/";
    }

    document.getElementById("userId").textContent = userId;
    document.getElementById("discordId").textContent = discordId;

    async function generate() {
      const r = await fetch("https://patient-frost-37d2.kurea-ch124.workers.dev/api/link/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId })
      });

      const j = await r.json();
      if (!j.code) {
        alert("コード生成失敗");
        return;
      }

      document.getElementById("code").textContent = j.code;
      document.getElementById("mc").textContent =
        `/link ${discordId} ${j.code}`;
    }
  </script>
</body>
</html>
